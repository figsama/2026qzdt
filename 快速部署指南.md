# 快速部署指南

## 📦 已为您准备的文件

✅ `visitor-tracker.js` - 访客追踪脚本  
✅ `访问统计地图.html` - 统计展示页面  
✅ `index.html` - 已添加 Firebase 代码（需取消注释）  
✅ `访问统计使用指南.md` - 详细使用说明  
✅ `FIREBASE_SETUP.md` - Firebase 配置教程  

## 🚀 三步完成部署

### 步骤 1: 配置 Firebase（10 分钟）

1. 访问 https://console.firebase.google.com/
2. 点击"添加项目"，输入项目名称（如：visa-map-stats）
3. 在左侧菜单点击"Firestore Database"，然后点击"创建数据库"
4. 选择"以测试模式启动"，选择位置（建议：asia-east1）
5. 在项目设置（⚙️图标）中，点击 Web 图标（</>），注册应用
6. 复制显示的配置代码

### 步骤 2: 修改配置（5 分钟）

#### 2.1 修改 `visitor-tracker.js` 第 11-17 行

```javascript
const firebaseConfig = {
  apiKey: "粘贴您的 apiKey",
  authDomain: "粘贴您的 authDomain",
  projectId: "粘贴您的 projectId",
  storageBucket: "粘贴您的 storageBucket",
  messagingSenderId: "粘贴您的 messagingSenderId",
  appId: "粘贴您的 appId"
};
```

#### 2.2 修改 `访问统计地图.html` 第 187-193 行

同样粘贴您的 Firebase 配置。

#### 2.3 修改 `index.html` 第 21-24 行

将这三行的注释符号删除（删除 `<!--` 和 `-->`）：

```html
<!-- 修改前 -->
<!--
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="visitor-tracker.js"></script>
-->

<!-- 修改后 -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="visitor-tracker.js"></script>
```

### 步骤 3: 部署到 GitHub（2 分钟）

```bash
# 添加所有文件
git add .

# 提交更改
git commit -m "添加访问统计功能"

# 推送到 GitHub
git push
```

等待 1-2 分钟，GitHub Pages 会自动部署。

## ✅ 验证部署

### 1. 测试主页追踪

1. 访问：https://figsama.github.io/2026qzdt/
2. 按 F12 打开浏览器控制台
3. 应该看到：`访问记录已保存: {…}`
4. 在 Firebase Console 的 Firestore Database 中应该能看到新的 `visits` 集合

### 2. 查看统计页面

1. 访问：https://figsama.github.io/2026qzdt/访问统计地图.html
2. 应该看到：
   - 总访问量、城市数等统计数据
   - 中国地图上的访客分布
   - 访问城市排行榜

## 🎯 配置 Firestore 安全规则（重要！）

为了防止数据被恶意修改，建议设置以下安全规则：

1. 在 Firebase Console 的 Firestore Database 页面
2. 点击"规则"标签
3. 粘贴以下规则：

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /visits/{visit} {
      // 允许任何人读取和创建
      allow read, create: if true;
      // 禁止更新和删除
      allow update, delete: if false;
    }
  }
}
```

4. 点击"发布"

## 📊 查看访问数据

### 方法 1：在网站上查看
访问：https://figsama.github.io/2026qzdt/访问统计地图.html

### 方法 2：在 Firebase Console 查看
1. 访问 Firebase Console
2. 点击"Firestore Database"
3. 查看 `visits` 集合的所有文档

### 方法 3：导出数据

在 Firebase Console 中可以：
- 直接查看每条记录的详细信息
- 使用筛选器查询特定条件的数据
- 使用 Firebase CLI 导出整个集合

## 🔧 常见问题

### Q1: 控制台显示 "访客追踪未配置"

**解决：** 您忘记修改 Firebase 配置了，请回到步骤 2。

### Q2: 统计页面显示 "未配置 Firebase"

**解决：** 您需要同时修改 `visitor-tracker.js` 和 `访问统计地图.html` 两个文件的配置。

### Q3: 数据没有保存到 Firebase

**检查：**
1. Firebase 配置是否正确
2. Firestore 是否已启用
3. 安全规则是否允许写入
4. 浏览器控制台是否有错误

### Q4: 城市显示为"未知"

**说明：** 这是正常的，原因可能是：
- 访客使用了 VPN
- IP 定位 API 没有该 IP 的数据
- API 请求失败

免费的 IP 定位服务准确度约为 80-90%。

## 💰 费用说明

**完全免费！** （在合理使用范围内）

Firebase 免费额度：
- Firestore 读取：50,000 次/天
- Firestore 写入：20,000 次/天
- 存储：1 GB

假设您的网站每天有 100 个访客：
- 写入：100 次（远低于 20,000）
- 统计页面访问 10 次，每次读取 100 条：1,000 次（远低于 50,000）

完全在免费额度内！

## 📈 后续优化建议

### 1. 添加隐私政策

在网站底部添加：
```
本站使用 Cookie 和访问统计技术以改善用户体验。
访问本站即表示您同意我们收集匿名的访问数据。
```

### 2. 设置使用量警报

在 Firebase Console 中：
1. 点击"Usage and billing"
2. 设置每日/每月预算警报
3. 当接近免费额度时会收到邮件通知

### 3. 定期备份数据

建议每月备份一次 Firestore 数据。

### 4. 监控异常访问

如果发现访问量异常增长，可能是被爬虫访问，可以考虑：
- 添加 reCAPTCHA
- 启用 Firebase App Check
- 在规则中添加速率限制

## 📚 更多帮助

- 详细使用说明：查看 `访问统计使用指南.md`
- Firebase 配置：查看 `FIREBASE_SETUP.md`
- Firebase 官方文档：https://firebase.google.com/docs
- 遇到问题：检查浏览器控制台的错误信息

---

🎉 恭喜！您已经完成了访问统计功能的部署！

现在您可以实时追踪网站的访客分布，了解您的内容在哪些地区最受欢迎。
